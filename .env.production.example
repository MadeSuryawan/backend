# .env.production.example
# Production environment configuration for BaliBlissed with Docker and Redis
# Copy this file to secrets/.env and update with your actual production values

# =============================================================================
# Application Settings
# =============================================================================
APP_NAME="BaliBlissed API"
DEBUG=false

# =============================================================================
# Server Configuration
# =============================================================================
# Server bind address (use 0.0.0.0 for Docker/containerized deployments)
HOST=0.0.0.0
PORT=8000
# Logging verbosity: DEBUG, INFO, WARNING, ERROR (recommended: INFO for production)
LOG_LEVEL=INFO
# Server-side request timeout in seconds
REQUEST_TIMEOUT=30
# Maximum request body size in MB (prevents DoS attacks)
MAX_REQUEST_SIZE_MB=10

# =============================================================================
# API Documentation
# =============================================================================
# IMPORTANT: Set to false in production to disable Swagger/ReDoc endpoints
# These endpoints can expose sensitive API information to attackers
DOCS_ENABLED=false

# =============================================================================
# Environment
# =============================================================================
ENVIRONMENT=production
LOG_TO_FILE=true
LOG_FILE=logs/app.log
PRODUCTION_FRONTEND_URL="https://your-domain.com"

# =============================================================================
# AI Configuration
# =============================================================================
GEMINI_API_KEY="your_production_api_key_here"
AI_REQUEST_TIMEOUT=60
AI_MAX_RETRIES=3
AI_RETRY_DELAY=1.0
AI_BACKOFF_FACTOR=2.0
# Content filtering: none, low, medium, high (recommended: medium or high for production)
AI_SAFETY_THRESHOLD=medium

# =============================================================================
# Database Settings (CRITICAL)
# =============================================================================
# Production PostgreSQL (use SSL for secure connections)
# Format: postgresql+asyncpg://username:password@host:port/database?ssl=require
# For Neon PostgreSQL: Add ?ssl=require to the connection string
DATABASE_URL=postgresql+asyncpg://user:password@host:5432/baliblissed?ssl=require

# Database Debug Settings (should be false in production)
DATABASE_ECHO=false

# Database Connection Pool Settings (increase for production)
POOL_SIZE=20
MAX_OVERFLOW=30
POOL_TIMEOUT=30
POOL_RECYCLE=3600

# =============================================================================
# Security Settings (CRITICAL)
# =============================================================================
# JWT Configuration
# Generate SECRET_KEY with: openssl rand -hex 32
# IMPORTANT: Must be at least 32 characters in production!
SECRET_KEY="your-secure-secret-key-min-32-characters-generate-with-openssl-rand-hex-32"
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7
JWT_ISSUER=baliblissed-api
JWT_AUDIENCE=baliblissed-client

# Account Lockout Settings
MAX_LOGIN_ATTEMPTS=5
LOCKOUT_DURATION_MINUTES=15

# Email Verification Settings
VERIFICATION_TOKEN_EXPIRE_HOURS=24
VERIFICATION_RESEND_LIMIT=3
FRONTEND_URL="https://your-domain.com"

# Password Reset Settings
PASSWORD_RESET_TOKEN_EXPIRE_HOURS=1
PASSWORD_RESET_RESEND_LIMIT=3

# Password Security Level
# Options: development, standard, high, paranoid
# Recommended: standard for most production, high for sensitive applications
PASSWORD_SECURITY_LEVEL=standard
PASSWORD_HASHER_DEBUG=false

# Trusted Hosts (CRITICAL for security)
# Comma-separated list of allowed Host header values
# Must include your production domain(s)
TRUSTED_HOSTS="your-domain.com,www.your-domain.com,api.your-domain.com"

# =============================================================================
# OAuth Configuration
# =============================================================================
# Google OAuth (Required for Google login)
GOOGLE_CLIENT_ID="your-google-client-id.apps.googleusercontent.com"
GOOGLE_CLIENT_SECRET="your-google-client-secret"

# WeChat OAuth (Optional - for WeChat login)
WECHAT_APP_ID=
WECHAT_APP_SECRET=

# OAuth State Token Expiration (seconds)
OAUTH_STATE_EXPIRE_SECONDS=600

# =============================================================================
# Gmail API Configuration
# =============================================================================
# Path to the OAuth credentials file downloaded from Google Cloud Console
GMAIL_CLIENT_SECRET_FILE=secrets/client_secret.json
# Path where the authorized user token will be stored
GMAIL_TOKEN_FILE=secrets/token.json
# The email address to send inquiries TO (your company email)
COMPANY_TARGET_EMAIL="your-company@example.com"

# SMTP Configuration (fallback email provider - recommended for production)
# Use services like SendGrid, AWS SES, or Mailgun for production
SMTP_HOST=
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=
SMTP_TLS=true
SMTP_FROM_EMAIL="noreply@your-domain.com"
SMTP_FROM_NAME="BaliBlissed"

# =============================================================================
# Redis Configuration (Production)
# =============================================================================
REDIS_ENABLED=true
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_USERNAME=
# IMPORTANT: REDIS_PASSWORD is required in production!
REDIS_PASSWORD="your_secure_redis_password_here"
# Alternative: Full Redis URL (overrides individual settings)
# Format: rediss:// for SSL connection
REDIS_URL=

# Redis SSL/TLS Configuration (REQUIRED for production)
# Enable SSL/TLS for secure Redis connections
# NOTE: Some cloud Redis providers (e.g., Upstash) may not support SSL internally
REDIS_SSL=true
# Path to CA certificates bundle file (PEM format)
REDIS_SSL_CA_CERTS=/etc/ssl/certs/ca-certificates.crt
# Path to CA certificates directory (alternative to CA_CERTS)
REDIS_SSL_CA_PATH=
# Certificate verification mode: none, optional, required
REDIS_SSL_CERT_REQS=required
# Client certificate authentication (mTLS - optional)
REDIS_SSL_CERTFILE=
REDIS_SSL_KEYFILE=
# Verify hostname matches certificate
REDIS_SSL_CHECK_HOSTNAME=true

# Rate Limiting
RATE_LIMIT_DEFAULT_LIMITS=500/3600s
IN_MEMORY_FALLBACK_ENABLED=true
HEADERS_ENABLED=true

# =============================================================================
# Storage Configuration
# =============================================================================
# Storage provider: "cloudinary" for production
STORAGE_PROVIDER=cloudinary
UPLOADS_DIR=uploads

# Cloudinary Configuration (REQUIRED when STORAGE_PROVIDER=cloudinary)
CLOUDINARY_CLOUD_NAME="your_cloud_name"
CLOUDINARY_API_KEY="your_api_key"
CLOUDINARY_API_SECRET="your_api_secret"

# =============================================================================
# Profile Picture Settings
# =============================================================================
PROFILE_PICTURE_MAX_SIZE_MB=5
PROFILE_PICTURE_MAX_DIMENSION=1024
PROFILE_PICTURE_QUALITY=85

# =============================================================================
# Media Upload Settings
# =============================================================================
MEDIA_IMAGE_MAX_SIZE_MB=5
MEDIA_IMAGE_MAX_COUNT_REVIEW=5
MEDIA_IMAGE_MAX_COUNT_BLOG=10
MEDIA_VIDEO_MAX_SIZE_MB=50
MEDIA_VIDEO_MAX_COUNT_BLOG=3

# =============================================================================
# IP Geolocation API Configuration
# =============================================================================
IP_GEOLOCATION_API_KEY="your_ip_geolocation_api_key_here"

# =============================================================================
# Performance Configuration (Production)
# =============================================================================
MAX_CONCURRENT_AI_REQUESTS=20
ENABLE_RESPONSE_CACHING=true
# Cache TTLs are longer in production for better performance
CACHE_TTL_ITINERARY=86400
CACHE_TTL_QUERY=3600
CACHE_TTL_CONTACT=1800

# =============================================================================
# Cache Configuration
# =============================================================================
CACHE_DEFAULT_TTL=3600
CACHE_MAX_TTL=86400
CACHE_KEY_PREFIX=cache
CACHE_COMPRESSION_ENABLED=true
CACHE_COMPRESSION_THRESHOLD=1024
CACHE_STRATEGY=LRU
CACHE_ENABLE_STATISTICS=true
CACHE_CLEANUP_INTERVAL=300

# =============================================================================
# Pagination Defaults
# =============================================================================
DEFAULT_PAGE_SIZE=10
MAX_PAGE_SIZE=100

# =============================================================================
# Docker Configuration (Production)
# =============================================================================
BUILD_TARGET=production
BACKEND_PORT=8000
MOUNT_MODE=ro

# Resource limits for production
BACKEND_MEMORY_LIMIT=2G
BACKEND_CPU_LIMIT=2.0
REDIS_MEMORY_LIMIT=1G
REDIS_CPU_LIMIT=1.0

# =============================================================================
# Security Configuration (Production)
# =============================================================================
# CORS - Only allow your production domains
CORS_ORIGINS="https://your-domain.com,https://www.your-domain.com"

# =============================================================================
# Health Check Configuration
# =============================================================================
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_ENDPOINT=/health

# =============================================================================
# Localization
# =============================================================================
# Timezone for consistent datetime handling (Asia/Singapore for Bali business)
TZ=Asia/Singapore

# =============================================================================
# Monitoring & Error Tracking (Production)
# =============================================================================
# Sentry DSN for error tracking (highly recommended for production)
# Get your DSN from: https://sentry.io/signup/
SENTRY_DSN=
SENTRY_ENVIRONMENT=production
# Sample rate for performance monitoring (0.0 to 1.0)
SENTRY_TRACES_SAMPLE_RATE=0.1

# =============================================================================
# Webhook Configuration (Production)
# =============================================================================
# Secret key for webhook signature verification
# Generate with: openssl rand -hex 32
WEBHOOK_SECRET=""

# =============================================================================
# Feature Flags (Production)
# =============================================================================
# Enable/disable specific features without code deployment
FEATURE_REGISTRATION_ENABLED=true
FEATURE_AI_CHAT_ENABLED=true
FEATURE_EMAIL_VERIFICATION_REQUIRED=true

# =============================================================================
# Production Deployment Notes
# =============================================================================
# 1. Copy this file to secrets/.env: cp .env.production.example secrets/.env
# 2. Generate a secure SECRET_KEY: openssl rand -hex 32
# 3. Update DATABASE_URL with your production database credentials
# 4. Set a strong REDIS_PASSWORD
# 5. Enable REDIS_SSL=true for secure Redis connections
# 6. Configure Cloudinary credentials for media storage
# 7. Update GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET for OAuth
# 8. Update COMPANY_TARGET_EMAIL to your company email
# 9. Place Gmail API credentials in secrets/client_secret.json
# 10. Configure SENTRY_DSN for error monitoring
# 11. Set DOCS_ENABLED=false to disable API docs in production
# 12. Configure TRUSTED_HOSTS with your production domains
# 13. Run: docker-compose -f docker-compose.prod.yml up -d
# 14. Run migrations: docker-compose exec backend alembic upgrade head
# 15. Monitor logs: docker-compose logs -f backend

# =============================================================================
# Validation Requirements (Enforced by Application)
# =============================================================================
# - SECRET_KEY must be at least 32 characters
# - REDIS_PASSWORD is required in production
# - CLOUDINARY_* variables are required when STORAGE_PROVIDER=cloudinary
# - REDIS_SSL warning will be issued if disabled in production
# - DOCS_ENABLED should be false in production (security warning if true)
# - TRUSTED_HOSTS is required in production (security requirement)
